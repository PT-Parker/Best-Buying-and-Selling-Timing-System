# Feature Specification: Replace n8n with Google Apps Script for Email

**Feature Branch**: `012-replace-n8n-with-gas`  
**Created**: 2025-10-21  
**Status**: Draft  
**Input**: User description: "移除全部的n8n，我要改用google apps script來寄送郵件"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Google-Native Email Automation (Priority: P1)

As a user, I want the system to use Google Apps Script for sending trading signal notifications, to simplify the architecture and rely on a single, integrated Google ecosystem.

**Why this priority**: This change simplifies the project's dependencies, removes a complex component (n8n), and makes the solution easier to maintain for users familiar with the Google ecosystem.

**Independent Test**: When a trading signal is generated by the core Python application, an email is successfully sent via a Google Apps Script function.

**Acceptance Scenarios**:

1. **Given** a new trading signal is generated, **When** the email notification step is triggered, **Then** a call is made to a designated Google Apps Script web app URL.
2. **Given** the Google Apps Script is successfully triggered, **When** it processes the request, **Then** an email with the correct signal data is sent to the configured recipient.

---

### User Story 2 - Removal of n8n (Priority: P2)

As a developer, I want all n8n-related files, configurations, and dependencies to be completely removed from the project codebase.

**Why this priority**: To ensure a clean codebase, reduce project size, and eliminate confusion by removing now-obsolete components.

**Independent Test**: The project can be fully installed and run without any n8n-related errors, and a search for "n8n" within the project files yields no results related to the old implementation.

**Acceptance Scenarios**:

1. **Given** the feature is implemented, **When** I list the project files, **Then** the entire `/n8n` directory and all related scripts (e.g., `n8n_bootstrap.ps1`) are gone.
2. **Given** the feature is implemented, **When** I check the project's dependencies, **Then** there are no remaining dependencies on n8n libraries.

---

### Edge Cases

- How should the system handle failures when calling the Google Apps Script URL (e.g., network errors, timeouts, invalid URL)?
- What happens if the Google Apps Script returns an error (e.g., daily email quota exceeded, invalid parameters)?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: The system MUST be able to make an HTTP POST request to a configurable Google Apps Script web app URL.
- **FR-002**: The request to the Google Apps Script MUST contain the trading signal data (time, symbol, action, price, reason) in a JSON payload.
- **FR-003**: The recipient's email address MUST be configurable within the system (e.g., via `EMAIL_TO.txt`).
- **FR-004**: All files, directories, and scripts related to the previous n8n implementation MUST be removed from the project.
- **FR-005**: The core Python application (`cli.py` or similar) MUST be updated to trigger the Google Apps Script call instead of the n8n webhook.

### Key Entities *(include if feature involves data)*

- **TradingSignal**: Represents the data sent to the Google Apps Script, containing: `time`, `symbol`, `action`, `price`, `reason`.
- **Configuration**: Represents system settings, including the Google Apps Script URL and recipient email address.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 100% of generated trading signals trigger a call to the Google Apps Script URL.
- **SC-002**: End-to-end email delivery time from signal generation to receipt is under 90 seconds.
- **SC-003**: The project's file count is reduced by at least 90% after removing the `n8n` directory.
- **SC-004**: The new implementation has zero dependencies on n8n or related packages.