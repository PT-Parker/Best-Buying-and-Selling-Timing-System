# Feature Specification: 測試 n8n 工作流程是否能推送 Gmail

**Feature Branch**: `010-test`  
**Created**: 2025-10-21  
**Status**: Draft  
**Input**: User description: "測試n8n工作流程能不能推送gmail"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 一鍵發送測試郵件並確認 (Priority: P1)

作為營運人員，我要能在需要時執行「測試寄送」，系統會發送一封標記為「測試」的郵件到指定 Gmail，並在合理時間內回報是否送達，讓我能快速判斷工作流程是否可用。

**Why this priority**: 直接驗證外部通知是否可達是最核心價值，影響監控與事件通知的可靠性。

**Independent Test**: 單獨執行「測試寄送」，不依賴其他模組，即可驗證是否在目標信箱於 SLA 內收到測試郵件並取得結果記錄。

**Acceptance Scenarios**:

1. **Given** 已設定收件 Gmail，**When** 執行測試寄送，**Then** 在 2 分鐘內可於 Gmail 收到主旨含「測試」與唯一識別碼的郵件，系統回報「送達」。
2. **Given** 收件位址格式錯誤，**When** 執行測試寄送，**Then** 立即給出易懂的錯誤訊息並標記「未送出」。
3. **Given** 外部服務暫時不可用，**When** 執行測試寄送，**Then** 顯示「暫時失敗，可重試」並保留錯誤代碼以利追蹤。

---

### User Story 2 - 管理測試紀錄與可追溯性 (Priority: P2)

作為營運人員，我需要查看近期測試歷史（時間、收件人、結果、備註），並可匯出，以便稽核與問題追蹤。

**Why this priority**: 發信可用性常受外部因素影響，歷史紀錄有助於定位問題與與他部門溝通。

**Independent Test**: 不發送新郵件，也能單獨開啟歷史列表，查看並匯出最近 N 筆測試結果。

**Acceptance Scenarios**:

1. **Given** 已有至少一筆測試，**When** 打開測試紀錄，**Then** 可見時間戳、收件人、結果（成功/失敗/暫時失敗）、訊息或代碼。
2. **Given** 需要分享，**When** 匯出紀錄，**Then** 產生可讀格式檔案，欄位包含必要資訊與脫敏處理（遮蔽部分信箱）。

---

### User Story 3 - 風險控管與濫發防護 (Priority: P3)

作為系統管理者，我需要限制測試頻率並在短時間多次測試時給出提醒，避免被判定為濫發或觸發信箱防護。

**Why this priority**: 避免影響寄信信譽與降低誤判風險，保障系統長期穩定。

**Independent Test**: 重複觸發多次測試，觀察節流與提示是否生效，且不影響後續正常測試。

**Acceptance Scenarios**:

1. **Given** 在 1 分鐘內已送出測試，**When** 再次請求，**Then** 顯示節流提示並拒絕執行。
2. **Given** 超過等待時間，**When** 再次測試，**Then** 正常執行且有新識別碼。

---

### Edge Cases

- 目的信箱的信箱容量已滿（硬退件）
- 目的信箱安全性設定拒收（政策性封鎖）
- 被歸類至垃圾郵件或促銷分頁（是否視為成功）
- 外部服務速率限制（過多請求）
- 網路中斷或 DNS 解析失敗
- 重複測試造成內容去重導致誤判未到達

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**：提供「一鍵測試寄送」動作，將測試郵件送至指定 Gmail 收件者。
- **FR-002**：收件者為可設定值；若未指定，預設使用專案維運信箱。執行前允許覆寫本次收件人。
- **FR-003**：測試郵件主旨需包含「測試」與唯一識別碼；內文包含時間戳與識別碼，便於搜尋與對帳。
- **FR-004**：回報測試結果（成功/失敗/暫時失敗）、時間、識別碼、摘要訊息；失敗需提供可供排錯的代碼或原因摘要。
- **FR-005**：提供近期測試歷史清單（至少最近 20 筆），支援匯出為可讀格式；對外分享的資料需遮蔽個資（如 user***@domain）。
- **FR-006**：實作節流：同一環境 60 秒內僅允許 1 次測試；超限須顯示提示並拒絕執行。
- **FR-007**：隱私與安全：測試僅使用必要資訊；不得長期保存完整郵件內容；分享或匯出須遮蔽個資。
- **FR-008**：成功判定：以使用者可在 Gmail 端於 2 分鐘內查詢到測試郵件為準；[NEEDS CLARIFICATION: 如被歸類垃圾郵件或促銷分頁是否仍視為成功?]
- **FR-009**：驗證方式：系統需提供「使用者回報收到」與（可選）自動檢核的擴充點；[NEEDS CLARIFICATION: 是否必須自動從信箱端驗證？]
- **FR-010**：收件目標：需明確設定測試收件 Gmail；[NEEDS CLARIFICATION: 使用共同測試信箱或由操作人每次輸入？]

### Key Entities *(include if feature involves data)*

- **TestRun（測試執行）**：識別碼、觸發者、時間、收件人、結果、訊息、可匯出標記。
- **Recipient（收件人）**：電郵地址、展示名稱（可選）、資料保護標記（是否可對外顯示）。
- **MessageMeta（訊息中繼）**：主旨、唯一識別碼、時間戳、（可選）投遞回應代碼或摘要。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**：90% 測試在觸發後 2 分鐘內由使用者確認「已收到」。
- **SC-002**：營運人員可在 1 分鐘內完成一次測試（從觸發到看到回報狀態）。
- **SC-003**：30 天內零件等（P0）測試無結果事件（若外部服務長時間中斷除外）。
- **SC-004**：與傳統人工驗證相比，驗證所需時間降低 80% 以上。

