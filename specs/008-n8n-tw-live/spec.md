# Feature Specification: 修復「TW Live Signals → Sheets + Email」工作流程錯誤

**Feature Branch**: `008-n8n-tw-live`  
**Created**: 2025-10-20  
**Status**: Draft  
**Input**: User description: "n8n的TW Live Signals ? Sheets + Email幫我解決錯誤"

## User Scenarios & Testing (mandatory)

### User Story 1 - 關鍵路徑可用性恢復 (Priority: P1)

作為營運/維運人員，我需要現有的即時通知流程「Webhook 接收 → 數據整理 → 寫入表單 → 寄出通知」在常態情境下能無錯地完成，讓日常監控與通知不中斷。

**Why this priority**: 直接影響通知的即時性與可信度，是最小可用價值的關鍵。

**Independent Test**: 使用已存在的測試工具向 Webhook 發送一筆標準測試負載，流程應寫入表單並觸發一封通知，整體流程完成且無錯誤訊息；回應時間在合理門檻內。

**Acceptance Scenarios**:
1. **Given** 提供有效的目標 URL 與必要授權，**When** 發送標準測試負載，**Then** 應回報成功、表單新增 1 筆資料、通知送達。
2. **Given** 表單或通知設定缺漏，**When** 發送標準測試負載，**Then** 應回報明確錯誤訊息（指出缺漏欄位），流程不中斷於不明狀態。

---

### User Story 2 - 問題診斷與可觀測性 (Priority: P2)

作為支援/開發人員，我需要能快速診斷「表單寫入」或「郵件寄送」失敗的原因（如無權限、識別碼錯誤、節點配置不全），並有清楚的復原指引。

**Why this priority**: 降低排除故障時間（MTTR），避免反覆嘗試與誤判。

**Independent Test**: 刻意提供無效識別碼或未配置的參數，系統應給出可行的修復指引（例如需要哪個識別碼/權限），並在日誌/輸出中可追溯。

**Acceptance Scenarios**:
1. **Given** 表單識別碼錯誤，**When** 送出測試，**Then** 應提示識別碼無效並指向如何取得正確值。
2. **Given** 通知參數缺失，**When** 送出測試，**Then** 應提示需配置的欄位與最小必要值，並避免洩漏敏感資訊。

---

### User Story 3 - 防呆與韌性 (Priority: P3)

作為流程管理者，我希望流程在遇到可預期的外部故障（速率限制、臨時連線中斷、第三方閾值）時有合理的保護與回復策略，避免單點錯誤擴散。

**Why this priority**: 提升整體穩定性與使用者信任度。

**Independent Test**: 模擬外部服務暫時不可用，驗證流程能回報清楚狀態、保留必要記錄，並在恢復後可正常運作。

**Acceptance Scenarios**:
1. **Given** 外部端點短暫不可用，**When** 觸發流程，**Then** 應回報可讀錯誤並避免重複無效嘗試。
2. **Given** 請求被限流，**When** 觸發流程，**Then** 應回報節流狀態與下一步建議（稍後再試/調整頻率）。

---

### Edge Cases
- 目標 URL 不可達或 DNS 問題
- 憑證/授權過期或權限不足
- 表單識別碼、郵件參數等必要欄位缺漏
- 回應延遲過長（逾時）或非預期格式
- 重複請求造成重複寫入/重複寄送

## Requirements (mandatory)

### Functional Requirements
- **FR-001**: 必須支援以單一標準測試負載驗證核心流程可用性（接收、整理、寫入、通知）。
- **FR-002**: 必須提供清楚的錯誤訊息與修復指引（指出缺漏欄位、無效識別碼或權限需求）。
- **FR-003**: 必須避免敏感資訊在輸出與紀錄中外洩（遮罩 URLs/識別碼/信箱片段等）。
- **FR-004**: 必須在合理逾時內回應，逾時應明確標示並不中斷後續診斷。
- **FR-005**: 必須對常見外部錯誤（不可達、限流、服務暫停）給出可讀狀態與建議。
- **FR-006**: 必須具有基本可追溯性（時間、狀態、摘要訊息），以利日後查核。

### Success Criteria
- **SC-001**: 以標準測試負載驗證時，≥ 95% 測試在 3 秒內得到結果摘要。
- **SC-002**: 針對配置錯誤的測試情境，100% 提供具體可行的修復指引。
- **SC-003**: 連續 1 週日常運作中，流程成功率 ≥ 99%，且無未處理例外中斷。
- **SC-004**: 所有輸出/紀錄均無敏感資訊外洩。

## Assumptions
- 現有流程目標是「接收→整理→寫入→通知」，不包含大規模轉換或批次處理。
- 測試用的標準負載不含商業敏感資料。
- 權限/識別碼由使用者/管理者提供，本功能僅檢查存在與可用性，非憑證管理工具。

