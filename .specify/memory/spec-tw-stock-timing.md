# 功能規格：台股買賣最佳時機（n8n + Agentic AI）

**功能分支**：`feature/tw-stock-timing-mvp`  
**建立日期**：2025-10-15  
**狀態**：草稿  
**輸入來源**：使用者需求：「台股買賣最佳時機（n8n + Agentic AI）」

## 使用者情境與測試（必填）

### 使用者故事 1－每日關鍵交易提示（優先序：P1）

身為自營投資人，我希望在每日收盤後可以收到針對自選股的買賣建議，讓我能快速判斷隔日盤前的策略。

**優先原因**：提供即時可行的交易決策，是 MVP 最小價值核心，可直接驗證系統分析能力。

**獨立測試方式**：模擬一組自選股與當日收盤資料，驗證系統是否生成涵蓋買/賣/觀望三種可能性的建議，並包含信心指標與理由。

**驗收情境**：

1. **Given** 已設定自選股清單，**When** n8n 工作流程於收盤後執行，**Then** 使用者收到包含各股票建議操作與理由的摘要。
2. **Given** 缺少特定股票的完整資料，**When** 系統生成建議，**Then** 該股票標註資料不足並提供補救建議。

---

### 使用者故事 2－觸發式即時警報（優先序：P2）

身為投資人，我希望當自選股在盤中突破自訂條件（例如成交量暴增或技術指標交叉）時收到通知，以便及時下單。

**優先原因**：提升系統即時性與交易價值，驗證 n8n 與 Agentic AI 的即時協同能力。

**獨立測試方式**：使用歷史即時資料回放，驗證觸發條件被偵測後 1 分鐘內發送通知，並附上簡潔操作建議。

**驗收情境**：

1. **Given** 已設定條件的股票，**When** 當盤中價格突破條件，**Then** 使用者在指定渠道（Line/Email）於 60 秒內收到推播含建議。

---

### 使用者故事 3－策略學習回饋（優先序：P3）

身為產品團隊，我希望系統能蒐集使用者對建議的回饋（採納或忽略、市場結果），讓 Agentic AI 可持續調整策略。

**優先原因**：建立閉環學習，為後續精準化奠定基礎，但非 MVP 第一日所需。

**獨立測試方式**：建立假資料回報流程，驗證回饋被寫入資料庫並納入下次分析報告。

**驗收情境**：

1. **Given** 使用者對建議按「採納」並輸入實際成交價，**When** 下一次生成報告，**Then** 顯示該建議的結果與學習摘要。

---

### 邊界情境

- 資料供應商 API 異常或延遲時如何處理？是否重試、改用備援資料源？
- 當股票遭遇重大事件（停牌、公開處分）時，系統如何標註並調整建議？
- 使用者自選股清單為空或僅有新上市股票時，如何避免產生空白報告？

## 需求（必填）

### 功能性需求

- **FR-001**：系統必須透過 n8n 定時取得台股當日收盤行情與技術指標原始資料。
- **FR-002**：Agentic AI 必須根據使用者自選股與策略設定生成買賣建議，包含信心分數與理由。
- **FR-003**：系統必須於每日固定時間將建議透過指定管道（Line Notify 或 Email）發送給使用者。
- **FR-004**：系統必須將所有輸入資料、分析結果與通知紀錄持久化保存，以利追溯與回測。
- **FR-005**：系統必須提供介面讓使用者自訂觸發條件並啟用/停用即時警報。
- **FR-006**：系統必須支援回饋收集，讓使用者回報實際執行情況與結果。
- **FR-007**：系統必須在資料不足或 AI 無法產生明確結論時提供保守建議或聲明。
- **FR-008**：系統必須在任務失敗時觸發告警給維運人員並記錄詳細錯誤。
- **FR-009**：系統必須支援多使用者帳號隔離與個人化設定。[需要釐清：採何種身份驗證與授權機制？]

### 關鍵實體

- **交易建議**：包含股票代號、建議動作（買進/賣出/觀望）、建議價格區間、信心分數、生成時間、依據的核心因子。
- **使用者設定**：包含自選股清單、通知管道、策略偏好、觸發條件、回饋紀錄。
- **市場資料**：台股行情原始資料、技術指標、重大公告與新聞摘要。

## 成功準則（必填）

### 可量測成果

- **SC-001**：每日收盤後 15 分鐘內成功生成並發送 95% 以上的自選股建議。
- **SC-002**：即時觸發通知的平均延遲小於 60 秒，錯漏報率低於 5%。
- **SC-003**：至少 70% 的早期使用者表示建議內容清楚可執行（問卷量測）。
- **SC-004**：系統可回放任一交易日的建議與實際結果，驗證數據完整性。

